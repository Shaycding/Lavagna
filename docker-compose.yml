    image: mysql:5.7
    container_name: lavagna-mysql
    environment:
      MYSQL_DATABASE: lavagna
      MYSQL_ROOT_PASSWORD: root
      MYSQL_USER: lavagna
      MYSQL_PASSWORD: lavagna
    volumes:
      - lavagna-mysql-data:/var/lib/mysql
    networks:
      - mysql-network

  lavagna:
    build:
      context: .
      dockerfile: light.Dockerfile
    container_name: lavagna-app
    depends_on:
      - db
    environment:
      # Tell Lavagna to use MySQL instead of HSQLDB
      LAVAGNA_DB_DIALECT: MYSQL
      LAVAGNA_DB_HOST: db
      LAVAGNA_DB_PORT: 3306
      LAVAGNA_DB_URL: jdbc:mysql://db:3306/lavagna?autoReconnect=true&useSSL=false
      LAVAGNA_DB_USERNAME: lavagna
      LAVAGNA_DB_PASSWORD: lavagna

      # Spring profile & port
      LAVAGNA_SPRING_PROFILE: prod
      LAVAGNA_PORT: 8080
    networks:
      - nginx-network
      - mysql-network

  nginx:
    image: nginx:alpine
    container_name: lavagna-nginx
    depends_on:
      - lavagna
    ports:
      - "8080:80"
      - "8081:8081"
    volumes:
      - ./nginx-lavagna.conf:/etc/nginx/conf.d/default.conf:ro
      - ./src/main/webapp:/var/www/lavagna/webapp:ro
      - ./target/lavagna/help:/var/www/lavagna/help:ro
    networks:
      - nginx-network
volumes:
  lavagna-mysql-data:   # MySQL persistence
  lavagna-data:         # optional app data (HSQLDB, logs, etc.)

networks:
  nginx-network:
  mysql-network:
